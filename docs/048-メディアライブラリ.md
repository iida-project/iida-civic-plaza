# 048 メディアライブラリ

## 概要
Supabase Storageを使ったメディア管理機能を実装する。
管理画面から画像のアップロード・一覧表示・削除ができるようにする。

## 関連要件
- 管理画面の機能拡張
- 画像管理の一元化

## 技術仕様

### ディレクトリ構成
```
src/app/(admin)/admin/media/
├── page.tsx              # メディア一覧ページ
├── actions.ts            # Server Actions
└── _components/
    ├── MediaGrid.tsx     # グリッド表示
    ├── MediaUploader.tsx # アップロード（D&D対応）
    └── MediaCard.tsx     # 個別カード
```

### Supabase Storage構成
- **バケット名**: `media`（既存）
- **パス構造**: `/YYYY/MM/filename.jpg`

### 画像使用状況チェック対象テーブル
| テーブル | カラム |
|---------|--------|
| `organizations` | `main_image_url`, `gallery_images` |
| `interviews` | `main_image_url` |
| `grants` | `thumbnail_url` |
| `news_posts` | `thumbnail_url` |

### 削除ワークフロー
1. 削除ボタンクリック
2. 使用状況をチェック（上記テーブル検索）
3. 使用中の場合は警告ダイアログ表示
   - 使用している記事のタイトル一覧を表示
4. ユーザーが確認後：
   - 関連する記事の画像URLをnullに更新
   - Storageから画像を削除

## Todo
- [ ] メディア一覧ページ作成（/admin/media）
- [ ] MediaGridコンポーネント作成（グリッド表示）
- [ ] MediaUploaderコンポーネント作成（D&D対応）
- [ ] MediaCardコンポーネント作成（ファイル名、日時表示）
- [ ] Server Actions実装（一覧取得、削除）
- [ ] 画像使用状況チェック機能
- [ ] 削除確認ダイアログ（使用中の場合は警告表示）
- [ ] 管理画面サイドバーに「メディア」メニュー追加

## 完了条件
- メディア一覧がグリッド形式で表示される
- ドラッグ&ドロップで画像をアップロードできる
- 使用中の画像を削除する際に警告が表示される
- 確認後、関連記事の画像URLがクリアされ、Storageから削除される

## 備考
- 記事編集画面の「削除」ボタンはURLクリアのみ（Storageからは削除しない）
- 完全な削除はメディアライブラリからのみ可能
