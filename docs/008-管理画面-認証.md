# 008 管理画面 - 認証（Supabase Auth）

## 概要
管理画面へのアクセス制御のため、Supabase Authを使用した認証機能を実装する。

## 関連要件
- 管理者のみが管理画面にアクセス可能
- セッション管理
- ログイン/ログアウト機能

## 技術仕様

### 使用技術
- Supabase Auth（メール/パスワード認証）
- Next.js Middleware（ルート保護）
- @supabase/ssr（サーバーサイド認証）

### 認証フロー
```
1. /admin アクセス
2. Middleware で認証チェック
3. 未認証 → /admin/login へリダイレクト
4. 認証済み → 管理画面表示
```

### ルーティング構成
```
app/
├─ (admin)/
│   ├─ layout.tsx          # 認証チェック付きレイアウト
│   ├─ admin/
│   │   ├─ page.tsx        # ダッシュボード
│   │   ├─ login/
│   │   │   └─ page.tsx    # ログインページ
│   │   └─ ...
```

### Supabase設定
- Authユーザーテーブルを使用
- 管理者のメールアドレスをホワイトリスト管理（または招待制）

## Todo
- [x] Supabase Auth 設定確認
- [x] ログインページ作成（/admin/login）
- [x] 認証用Server Actions作成
- [x] Middleware でルート保護
- [x] (admin) レイアウトで認証状態管理
- [x] ログアウト機能
- [ ] 管理者ユーザー作成（Supabase Dashboard）

## 完了条件
- /admin にアクセスすると認証が必要
- ログイン/ログアウトが正常に動作
- 未認証ユーザーは管理画面にアクセス不可

## 作成したファイル
- `src/middleware.ts` - ルート保護
- `src/lib/supabase/middleware.ts` - Middleware用Supabaseクライアント
- `src/app/(admin)/layout.tsx` - 管理画面レイアウト
- `src/app/(admin)/admin/page.tsx` - ダッシュボード
- `src/app/(admin)/admin/login/page.tsx` - ログインページ
- `src/app/(admin)/admin/actions.ts` - 認証Server Actions
- `src/app/(admin)/admin/_components/LogoutButton.tsx` - ログアウトボタン

## 備考
- 初期は1〜2名の管理者想定
- 将来的に役割（admin/editor）追加の可能性あり
- 管理者ユーザーはSupabase Dashboardから手動作成が必要
